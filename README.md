# 📑 گزارش‌کار: پیش‌پردازش داده‌های حفاری برای آموزش مدل

## 🧭 هدف

هدف این اسکریپت، پیش‌پردازش داده‌های خام مربوط به چاه‌های حفاری است. داده‌ها آماده می‌شوند برای استفاده در مدل‌های یادگیری ماشین با انجام مراحل:

- حذف مقادیر گمشده
- نرمال‌سازی ویژگی‌های عددی با MinMaxScaler
- تبدیل ویژگی‌های متنی به عددی با One-Hot Encoding
- شناسایی و حذف داده‌های پرت با استفاده از Z-Score و IQR
- ذخیره داده‌ی پاک‌شده و داده‌های پرت به صورت جداگانه
- ذخیره مقادیر min و max برای بازگردانی مقادیر نرمال‌شده

## 📁 ساختار مسیرها

| مسیر | توضیح |
|------|--------|
| `dataset/fdms_well_datasets/` | ورودی فایل‌های خام `.parquet` مربوط به هر چاه |
| `dataset/processed/` | خروجی داده‌های پاک‌سازی‌شده (بدون پرت و NaN) |
| `dataset/outliers/` | خروجی داده‌های پرت شناسایی‌شده |
| `dataset/means/` | ذخیره مقادیر `min` و `max` ویژگی‌های عددی هر چاه در قالب JSON |

## ⚙️ مراحل انجام شده در کد

### 1. بارگذاری فایل‌های `.parquet`
برای هر چاه از مسیر ورودی، فایل بارگذاری می‌شود.

### 2. حذف مقادیر گمشده
ردیف‌هایی که شامل مقدار NaN هستند حذف می‌شوند:
```python
df = df.dropna()
```

### 3. انتخاب ویژگی‌های عددی و محاسبه آماره‌ها
ویژگی‌های عددی انتخاب می‌شوند و مقادیر `min` و `max` برای آن‌ها محاسبه می‌شود:
```python
original_min = df[numeric_cols].min().to_dict()
original_max = df[numeric_cols].max().to_dict()
```

### 4. نرمال‌سازی با MinMaxScaler
ویژگی‌های عددی به بازه `[0, 1]` نرمال‌سازی می‌شوند:
```python
scaler = MinMaxScaler()
df[numeric_cols] = scaler.fit_transform(df[numeric_cols])
```

### 5. تبدیل ویژگی‌های متنی
با استفاده از One-Hot Encoding:
```python
df = pd.get_dummies(df, columns=categorical_cols)
```

### 6. شناسایی داده‌های پرت
با دو روش انجام می‌شود:

- **Z-Score Method** (مقدار مطلق بزرگ‌تر از 3)
- **IQR Method** (بیرون از بازه `[Q1 - 1.5*IQR, Q3 + 1.5*IQR]`)

### 7. ذخیره نتایج

- داده پاک‌شده → `dataset/processed/cleaned_<WELL_ID>.parquet`
- داده‌های پرت → `dataset/outliers/outliers_<WELL_ID>.parquet`
- مقادیر min/max → `dataset/means/mean_<WELL_ID>.json`

نمونه ساختار فایل JSON ذخیره‌شده:
```json
{
  "WELL_ID": 362,
  "scaling_method": "minmax",
  "min": {
    "DEPTH": 1234.0,
    "RPM": 100.0
  },
  "max": {
    "DEPTH": 2345.0,
    "RPM": 250.0
  }
}
```

## ✅ نتیجه نهایی

در پایان، داده‌های خام برای هر چاه:

- تمیزسازی و نرمال‌سازی شده‌اند
- داده‌های پرت حذف و ذخیره شده‌اند
- مقادیر آماری برای بازگشت‌پذیری کامل نرمال‌سازی ذخیره شده‌اند

</div>
